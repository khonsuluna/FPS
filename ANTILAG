--// HELL TURBO MODE + POTATO V3
local GUI_NAME = "HellTurboGui"

if game.CoreGui:FindFirstChild(GUI_NAME) then
    game.CoreGui:FindFirstChild(GUI_NAME):Destroy()
end

local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = GUI_NAME
gui.ResetOnSpawn = false

local function makeButton(text, y)
    local b = Instance.new("TextButton", gui)
    b.Size = UDim2.new(0, 120, 0, 25)
    b.Position = UDim2.new(0, 10, 0, y)
    b.BackgroundColor3 = Color3.fromRGB(30,30,30)
    b.TextColor3 = Color3.fromRGB(255,255,255)
    b.Text = text
    return b
end

local turboBtn   = makeButton("TURBO OFF", 80)
local renderBtn  = makeButton("3D ON",     110)
local playersBtn = makeButton("PLAYERS ON",140)
local accBtn     = makeButton("ACC ON",    170)
local grassBtn   = makeButton("GRASS ON",  200)
local animBtn    = makeButton("ANIM ON",   230)
local distBtn    = makeButton("DIST ON",   260)
local potatoBtn  = makeButton("POTATO V3 OFF", 290) -- NEW

local ultra = false
local render = true
local players = true
local acc = true
local anim = true
local dist = true
local grass = true
local potato = false

local RunService = game:GetService("RunService")
local SoundService = game:GetService("SoundService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Save some safe defaults to restore later
local SAFE = {
    QualityLevel = (pcall(function() return settings().Rendering.QualityLevel end) and settings().Rendering.QualityLevel) or Enum.QualityLevel.Automatic,
    Brightness = game.Lighting and game.Lighting.Brightness or 2,
    Ambient = game.Lighting and game.Lighting.Ambient or Color3.new(0.5,0.5,0.5),
    OutdoorAmbient = game.Lighting and game.Lighting.OutdoorAmbient or Color3.new(0.5,0.5,0.5),
    FOV = workspace.CurrentCamera and workspace.CurrentCamera.FieldOfView or 70,
    SoundVolume = SoundService.Volume
}

-- Helper: shallow-safe iterate workspace objects
local function lightweightSweep(fn)
    for _, v in ipairs(workspace:GetDescendants()) do
        pcall(function() fn(v) end)
    end
end

-- ULTRA TURBO (existing)
local function applyUltra(state)
    if state then
        pcall(function() settings().Rendering.QualityLevel = Enum.QualityLevel.Level01 end)

        lightweightSweep(function(v)
            if v:IsA("BasePart") then
                v.Material = Enum.Material.SmoothPlastic
                v.Reflectance = 0
            end
            if v:IsA("Decal") or v:IsA("Texture") then
                v.Transparency = 1
            end
            if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Smoke") then
                v.Enabled = false
            end
            if v:IsA("MeshPart") then
                pcall(function()
                    v.RenderFidelity = Enum.RenderFidelity.Performance
                    v.TextureID = ""
                end)
            end
            if v:IsA("SurfaceAppearance") then
                v:Destroy()
            end
        end)

        local L = game.Lighting
        if L then
            L.GlobalShadows = false
            L.Ambient = Color3.new(1,1,1)
            L.OutdoorAmbient = Color3.new(1,1,1)
            L.Brightness = 1
            L.FogEnd = 9e9
            L.EnvironmentDiffuseScale = 0
            L.EnvironmentSpecularScale = 0
        end

        if workspace.CurrentCamera then workspace.CurrentCamera.FieldOfView = 70 end
        pcall(function() setfpscap(9999) end)
    else
        pcall(function() settings().Rendering.QualityLevel = SAFE.QualityLevel end)
        if game.Lighting then
            game.Lighting.Brightness = SAFE.Brightness
            game.Lighting.Ambient = SAFE.Ambient
            game.Lighting.OutdoorAmbient = SAFE.OutdoorAmbient
        end
        if workspace.CurrentCamera then workspace.CurrentCamera.FieldOfView = SAFE.FOV end
    end
end

-- HIDE PLAYERS
local function hidePlayers(state)
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character then
            for _, part in ipairs(plr.Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.LocalTransparencyModifier = state and 1 or 0
                end
                if part:IsA("Accessory") or part:IsA("Hat") then
                    part.LocalTransparencyModifier = state and 1 or 0
                end
            end
        end
    end
end

-- KILL ACCESSORIES (shallow hide)
local function killAcc(state)
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr.Character then
            for _, v in ipairs(plr.Character:GetDescendants()) do
                if v:IsA("Accessory") or v:IsA("Hat") or v:IsA("MeshPart") then
                    v.Transparency = state and 1 or 0
                end
            end
        end
    end
end

-- GRASS toggle
local function grassOff(state)
    pcall(function()
        if workspace:FindFirstChild("Terrain") then
            workspace.Terrain.Decoration = not state
        end
    end)
end

-- ANIM KILL (local player)
local function killAnim(state)
    local lp = LocalPlayer
    if not lp then return end
    if not lp.Character then return end
    local humanoid = lp.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        if state then
            for _, t in ipairs(humanoid:GetPlayingAnimationTracks()) do
                pcall(function() t:Stop() end)
            end
        else
            -- nothing fancy to resume
        end
    end
end

-- DIST (render distance)
local function distOff(state)
    if workspace.CurrentCamera then
        -- state true -> normal, false -> tiny distance
        workspace.CurrentCamera.MaxZoomDistance = state and 400 or 8
    end
end

-- POTATO V3: heavy enforcement + extra kills
local potatoLoopThread = nil
local function applyPotato(state)
    if state then
        potato = true

        -- extreme lighting / quality / camera
        pcall(function() settings().Rendering.QualityLevel = Enum.QualityLevel.Level01 end)
        if game.Lighting then
            game.Lighting.GlobalShadows = false
            game.Lighting.Ambient = Color3.new(0.95,0.95,0.95)
            game.Lighting.OutdoorAmbient = Color3.new(0.95,0.95,0.95)
            game.Lighting.Brightness = 0.4
            game.Lighting.FogEnd = 9e9
            game.Lighting.EnvironmentDiffuseScale = 0
            game.Lighting.EnvironmentSpecularScale = 0
        end
        if workspace.CurrentCamera then
            workspace.CurrentCamera.FieldOfView = 35
        end

        -- kill all sounds
        pcall(function()
            SoundService.Volume = 0
            -- stop any Sound instances in workspace / lighting / players (best-effort)
            for _, s in ipairs(workspace:GetDescendants()) do
                if s:IsA("Sound") then
                    pcall(function() s:Stop() end)
                end
            end
            for _, s in ipairs(game:GetDescendants()) do
                if s:IsA("Sound") and (s.Parent == workspace or s.Parent == game.Lighting) then
                    pcall(function() s:Stop() end)
                end
            end
        end)

        -- deep sweep: demolish visual heavy items
        lightweightSweep(function(v)
            -- particles/trails/smoke/beams/sparkles/highlights
            if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Smoke")
            or v:IsA("Beam") or v:IsA("Sparkles") or v:IsA("Highlight") then
                pcall(function() v.Enabled = false end)
            end

            -- decals / textures / faces
            if v:IsA("Decal") or v:IsA("Texture") then
                pcall(function() v.Transparency = 1 end)
            end

            -- surfaceappearance / pbr
            if v:IsA("SurfaceAppearance") then
                pcall(function() v:Destroy() end)
            end

            -- meshpart => performance
            if v:IsA("MeshPart") then
                pcall(function()
                    v.RenderFidelity = Enum.RenderFidelity.Performance
                    v.TextureID = ""
                end)
            end

            -- basepart cheap
            if v:IsA("BasePart") then
                pcall(function()
                    v.Material = Enum.Material.SmoothPlastic
                    v.Reflectance = 0
                    -- reduce vertex cost by making small parts transparent (best-effort)
                    if v.Size.Magnitude < 0.5 then
                        v.Transparency = 1
                    end
                end)
            end
        end)

        -- hide other players and accessories aggressively
        hidePlayers(true)
        killAcc(true)
        grassOff(true)
        killAnim(true)
        distOff(false)

        -- small loop to enforce on new spawned objects (lightweight, 1s)
        if potatoLoopThread then
            pcall(function() potatoLoopThread:Cancel() end)
            potatoLoopThread = nil
        end
        potatoLoopThread = task.spawn(function()
            while potato do
                -- reapply lightweightSweep to pick up newly spawned objects
                lightweightSweep(function(v)
                    pcall(function()
                        if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Smoke")
                        or v:IsA("Beam") or v:IsA("Sparkles") or v:IsA("Highlight") then
                            v.Enabled = false
                        end
                        if v:IsA("Decal") or v:IsA("Texture") then
                            v.Transparency = 1
                        end
                        if v:IsA("SurfaceAppearance") then
                            v:Destroy()
                        end
                        if v:IsA("MeshPart") then
                            v.RenderFidelity = Enum.RenderFidelity.Performance
                            v.TextureID = ""
                        end
                        if v:IsA("BasePart") then
                            v.Material = Enum.Material.SmoothPlastic
                            v.Reflectance = 0
                        end
                        if v:IsA("Sound") then
                            pcall(function() v:Stop() end)
                        end
                    end)
                end)
                -- keep other players hidden
                hidePlayers(true); killAcc(true)
                task.wait(1)
            end
        end)

    else
        -- turn off potato enforcement
        potato = false
        if potatoLoopThread then
            pcall(function() potatoLoopThread:Cancel() end)
            potatoLoopThread = nil
        end

        -- restore some safe defaults
        pcall(function() settings().Rendering.QualityLevel = SAFE.QualityLevel end)
        if game.Lighting then
            game.Lighting.Brightness = SAFE.Brightness
            game.Lighting.Ambient = SAFE.Ambient
            game.Lighting.OutdoorAmbient = SAFE.OutdoorAmbient
            game.Lighting.EnvironmentDiffuseScale = 1
            game.Lighting.EnvironmentSpecularScale = 1
        end
        if workspace.CurrentCamera then workspace.CurrentCamera.FieldOfView = SAFE.FOV end
        pcall(function() SoundService.Volume = SAFE.SoundVolume end)

        -- bring players visuals back (best-effort)
        hidePlayers(false)
        killAcc(false)
        grassOff(false)
        killAnim(false)
        distOff(true)

        -- NOTE: decals/textures/surfaceappearance removed cannot be fully restored automatically in many games.
    end
end

-- BUTTON Events
turboBtn.MouseButton1Click:Connect(function()
    ultra = not ultra
    turboBtn.Text = ultra and "TURBO ON" or "TURBO OFF"
    applyUltra(ultra)
end)

-- UPDATED WHITE MODE button (keamanan + overlay handled here)
renderBtn.MouseButton1Click:Connect(function()
    render = not render
    renderBtn.Text = render and "3D ON" or "3D OFF"

    local RS = RunService
    local sound = SoundService
    local cam = workspace.CurrentCamera
    local L = game.Lighting

    RS:Set3dRenderingEnabled(render)

    if not render then
        -- mute sound
        pcall(function() sound.Volume = 0 end)

        -- reduce camera load
        if cam then cam.FieldOfView = 40 end

        -- lower brightness
        if L then L.Brightness = 0.5 end

        -- overlay soft white
        if not gui:FindFirstChild("WhiteOverlay") then
            local w = Instance.new("Frame", gui)
            w.Name = "WhiteOverlay"
            w.BackgroundColor3 = Color3.new(1,1,1)
            w.BackgroundTransparency = 0.05
            w.Size = UDim2.new(1,0,1,0)
            w.ZIndex = 9999
        end
    else
        -- restore
        pcall(function() sound.Volume = SAFE.SoundVolume end)
        if cam then cam.FieldOfView = SAFE.FOV end
        if L then L.Brightness = SAFE.Brightness end
        if gui:FindFirstChild("WhiteOverlay") then gui.WhiteOverlay:Destroy() end
    end
end)

playersBtn.MouseButton1Click:Connect(function()
    players = not players
    playersBtn.Text = players and "PLAYERS ON" or "PLAYERS OFF"
    hidePlayers(not players)
end)

accBtn.MouseButton1Click:Connect(function()
    acc = not acc
    accBtn.Text = acc and "ACC ON" or "ACC OFF"
    killAcc(not acc)
end)

grassBtn.MouseButton1Click:Connect(function()
    grass = not grass
    grassBtn.Text = grass and "GRASS ON" or "GRASS OFF"
    grassOff(not grass)
end)

animBtn.MouseButton1Click:Connect(function()
    anim = not anim
    animBtn.Text = anim and "ANIM ON" or "ANIM OFF"
    killAnim(not anim)
end)

distBtn.MouseButton1Click:Connect(function()
    dist = not dist
    distBtn.Text = dist and "DIST ON" or "DIST OFF"
    distOff(not dist)
end)

-- POTATO V3 button
potatoBtn.MouseButton1Click:Connect(function()
    potato = not potato
    potatoBtn.Text = potato and "POTATO V3 ON" or "POTATO V3 OFF"
    applyPotato(potato)
end)
